INSERT INTO BRANDS values ('B01','2376 Champion Ct','Puma',current_date);
INSERT INTO BRANDS values ('B02','76 Anavrin Point','Anavrin',current_date);

INSERT INTO LOYALTY_PROGRAM values ('LTP_B01','SportGoods','B01',1,0);
INSERT INTO LOYALTY_PROGRAM values ('LTP_B02','Grocery Store','B02',0,0);

INSERT INTO CUSTOMER values ('C0001','20 Ingram Street, NY','Peter Parker',8636234678,'W0001');
INSERT INTO CUSTOMER values ('C0002','560 Lemon Street, NC','Steve Smith',8676547657,'W0002');

INSERT INTO ACTIVITY_CATEGORY values ('A001','Purchase');
INSERT INTO ACTIVITY_CATEGORY values ('A002','Write a review');
INSERT INTO ACTIVITY_CATEGORY values ('A003','Refer a friend');

INSERT INTO REWARD_CATEGORY values ('RW001','Gift Card');
INSERT INTO REWARD_CATEGORY values ('RW002','Free Product');

INSERT INTO REWARD values ('LTP_B01','RW001','Gift Card');
INSERT INTO REWARD values ('LTP_B01','RW002','Free Product');
INSERT INTO REWARD values ('LTP_B02','RW001','Gift Card');

INSERT INTO ACTIVITY values ('LTP_B01','A001','Purchase');
INSERT INTO ACTIVITY values ('LTP_B02','A001','Purchase');
INSERT INTO ACTIVITY values ('LTP_B02','A002','Write a review');

INSERT INTO TIERS values ('LTP_B01','Bronze',0,0,1);
INSERT INTO TIERS values ('LTP_B01','Silver',1,170,2);
INSERT INTO TIERS values ('LTP_B01','Gold',2,270,3);

INSERT INTO RE_RULES values ('RER01','LTP_B01','Purchase',15,1);
INSERT INTO RE_RULES values ('RER02','LTP_B02','Purchase',40,1);
INSERT INTO RE_RULES values ('RER03','LTP_B02','Write a review',30,1);

INSERT INTO RR_RULES values ('RRR01','LTP_B01','Gift Card',80,40,1);
INSERT INTO RR_RULES values ('RRR02','LTP_B01','Free Product',70,25,1);
INSERT INTO RR_RULES values ('RRR03','LTP_B02','Gift Card',120,30,1);

INSERT INTO ENROLL_CUSTOMER values ('C0001','LTP_B01');
INSERT INTO ENROLL_CUSTOMER values ('C0001','LTP_B02');
INSERT INTO ENROLL_CUSTOMER values ('C0002','LTP_B01');

SELECT E.CUSTOMER_ID, C.NAME, B.BRAND_NAME FROM ENROLL_CUSTOMER E, LOYALTY_PROGRAM L, CUSTOMER C, BRANDS B WHERE E.CUSTOMER_ID = C.CUSTOMER_ID and E.LP_CODE = L.CODE and L.BRAND_ID = B.BRAND_ID;

-- Q1
SELECT DISTINCT C.CUSTOMER_ID, C.NAME FROM CUSTOMER C, ENROLL_CUSTOMER EC, LOYALTY_PROGRAM LP WHERE LP.BRAND_ID = 'B01' and LP.CODE = EC.LP_CODE and EC.CUSTOMER_ID <> C.CUSTOMER_ID;
-- Q3
SELECT R.REWARD_ID, R.REWARD_NAME FROM REWARD R, LOYALTY_PROGRAM L WHERE L.BRAND_ID = 'B01' and R.LP_CODE = L.CODE;
-- Q6
SELECT C.CUSTOMER_ID, C.NAME FROM CUSTOMER C WHERE C.WALLET_ID IN (SELECT W.WALLET_ID FROM WALLET W WHERE W.CATEGORY = 'REDEEM' and W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B01') GROUP BY (W.WALLET_ID) HAVING COUNT(*) > 1);
-- Q7
SELECT B.BRAND_ID, B.BRAND_NAME FROM BRANDS B, LOYALTY_PROGRAM L WHERE B.BRAND_ID = L.BRAND_ID and L.CODE IN (SELECT LP_CODE FROM WALLET WHERE CATEGORY = 'REDEEM' GROUP BY LP_CODE HAVING -1*SUM(POINTS) < 500);
-- Q2 List customers that have joined a loyalty program but have not participated in any activity in that program
SELECT EC.CUSTOMER_ID, EC.LP_CODE FROM ENROLL_CUSTOMER EC WHERE EXISTS(SELECT W.WALLET_ID FROM WALLET W, CUSTOMER C WHERE EC.CUSTOMER_ID = C.CUSTOMER_ID and C.WALLET_ID = W.WALLET_ID and W.LP_CODE = EC.LP_CODE GROUP BY W.WALLET_ID, W.LP_CODE HAVING COUNT(*) < 2);
-- Q5 For Brand01, list for each activity type in their loyalty program, the number instances that have occurred
SELECT W.ACTIVITY_NAME, COUNT(*) AS FREQUENCY FROM WALLET W WHERE W.CATEGORY = 'EARN' and W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B02') GROUP BY W.ACTIVITY_NAME;
-- Q4
SELECT CODE, NAME FROM LOYALTY_PROGRAM WHERE CODE IN (SELECT LP_CODE FROM RE_RULES WHERE ACTIVITY_NAME = 'Refer a friend');
-- Q8 For Customer C0003, and Brand02, number of activities they have done in the period of 08/1/2021 and 9/30/2021
SELECT COUNT(*) as NUMBER_OF_ACTIVITIES FROM WALLET W WHERE W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B01') and W.WALLET_ID = (SELECT WALLET_ID FROM CUSTOMER WHERE CUSTOMER_ID = 'C0002') and W."DATE" >= TO_DATE('11/06/2021', 'MM/DD/YYYY') and W."DATE" < TO_DATE('11/08/2021', 'MM/DD/YYYY');

