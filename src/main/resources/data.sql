-- Market Place Users
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('admin123', 'ADMIN', null, 'admin');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'BRAND', 'B01', 'brand01');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'BRAND', 'B02', 'brand02');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'BRAND', 'B03', 'brand03');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'CUSTOMER', 'C0001', 'peter');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'CUSTOMER', 'C0002', 'steve');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'CUSTOMER', 'C0003', 'diana');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'CUSTOMER', 'C0004', 'billy');
INSERT INTO MARKET_PLACE_USER (PASSWORD, ROLE, ROLE_ID, USER_NAME) values ('password', 'CUSTOMER', 'C0005', 'tony');

-- Activities
INSERT INTO ACTIVITY_CATEGORY(ACTIVITY_ID, ACTIVITY_NAME) values ('A01','Purchase');
INSERT INTO ACTIVITY_CATEGORY(ACTIVITY_ID, ACTIVITY_NAME) values ('A02','Write a review');
INSERT INTO ACTIVITY_CATEGORY(ACTIVITY_ID, ACTIVITY_NAME) values ('A03','Refer a friend');

-- Rewards
INSERT INTO REWARD_CATEGORY(REWARD_ID, REWARD_NAME) values ('R01','Gift Card');
INSERT INTO REWARD_CATEGORY(REWARD_ID, REWARD_NAME) values ('R02','Free Product');

-- Brand 1
INSERT INTO BRANDS(BRAND_ID, ADDRESS, BRAND_NAME, JOIN_DATE) VALUES ('B01','503 Rolling Creek Dr Austin, AR','Brand X',TO_DATE('11-04-2021','MM-DD-YYYY'));
INSERT INTO LOYALTY_PROGRAM(CODE, NAME, BRAND_ID, IS_TIERED, IS_VALIDATED) VALUES ('TLP01','SportGoods','B01',1,0);
INSERT INTO TIERS(LP_CODE, TIER_NAME, "LEVEL", POINTS_REQUIRED, MULTIPLIER) VALUES ('TLP01','Bronze',0,0,1);
INSERT INTO TIERS(LP_CODE, TIER_NAME, "LEVEL", POINTS_REQUIRED, MULTIPLIER) VALUES ('TLP01','Silver',1,170,2);
INSERT INTO TIERS(LP_CODE, TIER_NAME, "LEVEL", POINTS_REQUIRED, MULTIPLIER) VALUES ('TLP01','Gold',2,270,3);
INSERT INTO ACTIVITY(LP_CODE, ACTIVITY_ID, ACTIVITY_NAME) VALUES ('TLP01','A01','Purchase');
INSERT INTO ACTIVITY(LP_CODE, ACTIVITY_ID, ACTIVITY_NAME) VALUES ('TLP01','A02','Write a review');
INSERT INTO REWARD(LP_CODE, REWARD_ID, REWARD_NAME) VALUES ('TLP01','R01','Gift Card');
INSERT INTO REWARD(LP_CODE, REWARD_ID, REWARD_NAME) VALUES ('TLP01','R02','Free Product');
INSERT INTO RE_RULES(RULE_CODE, LP_CODE, ACTIVITY_NAME, POINTS, VERSION) VALUES ('RER01','TLP01','Purchase',15,1);
INSERT INTO RE_RULES(RULE_CODE, LP_CODE, ACTIVITY_NAME, POINTS, VERSION) VALUES ('RER02','TLP01','Write a review',10,1);
INSERT INTO RR_RULES(RULE_CODE, LP_CODE, REWARD_NAME, POINTS, INSTANCES, VERSION) VALUES ('RRR01','TLP01','Gift Card',80,40,1);
INSERT INTO RR_RULES(RULE_CODE, LP_CODE, REWARD_NAME, POINTS, INSTANCES, VERSION) VALUES ('RRR02','TLP01','Free Product',70,25,1);

-- Brand 2
INSERT INTO BRANDS(BRAND_ID, ADDRESS, BRAND_NAME, JOIN_DATE) VALUES ('B02','939 Orange Ave Coronado, CA','Brand Y',TO_DATE('11-07-2021','MM-DD-YYYY'));
INSERT INTO LOYALTY_PROGRAM(CODE, NAME, BRAND_ID, IS_TIERED, IS_VALIDATED) VALUES ('TLP02','MegaCenter','B02',1,0);
INSERT INTO TIERS(LP_CODE, TIER_NAME, "LEVEL", POINTS_REQUIRED, MULTIPLIER) VALUES ('TLP02','Special',0,0,1);
INSERT INTO TIERS(LP_CODE, TIER_NAME, "LEVEL", POINTS_REQUIRED, MULTIPLIER) VALUES ('TLP02','Premium',1,210,2);
INSERT INTO ACTIVITY(LP_CODE, ACTIVITY_ID, ACTIVITY_NAME) VALUES ('TLP02','A01','Purchase');
INSERT INTO ACTIVITY(LP_CODE, ACTIVITY_ID, ACTIVITY_NAME) VALUES ('TLP02','A03','Refer a friend');
INSERT INTO REWARD(LP_CODE, REWARD_ID, REWARD_NAME) VALUES ('TLP02','R01','Gift Card');
INSERT INTO REWARD(LP_CODE, REWARD_ID, REWARD_NAME) VALUES ('TLP02','R02','Free Product');
INSERT INTO RE_RULES(RULE_CODE, LP_CODE, ACTIVITY_NAME, POINTS, VERSION) VALUES ('RER03','TLP02','Purchase',40,1);
INSERT INTO RE_RULES(RULE_CODE, LP_CODE, ACTIVITY_NAME, POINTS, VERSION) VALUES ('RER04','TLP02','Refer a friend',30,1);
INSERT INTO RR_RULES(RULE_CODE, LP_CODE, REWARD_NAME, POINTS, INSTANCES, VERSION) VALUES ('RRR03','TLP02','Gift Card',120,30,1);
INSERT INTO RR_RULES(RULE_CODE, LP_CODE, REWARD_NAME, POINTS, INSTANCES, VERSION) VALUES ('RRR04','TLP02','Free Product',90,50,1);

-- Brand 3
INSERT INTO BRANDS(BRAND_ID, ADDRESS, BRAND_NAME, JOIN_DATE) VALUES ('B03','"20 Roszel Rd Princeton, NJ','Brand Z',TO_DATE('11-11-2021','MM-DD-YYYY'));
INSERT INTO LOYALTY_PROGRAM(CODE, NAME, BRAND_ID, IS_TIERED, IS_VALIDATED) VALUES ('RLP01','TechSups','B03',0,0);
INSERT INTO ACTIVITY(LP_CODE, ACTIVITY_ID, ACTIVITY_NAME) VALUES ('RLP01','A03','Refer a friend');
INSERT INTO REWARD(LP_CODE, REWARD_ID, REWARD_NAME) VALUES ('RLP01','R01','Gift Card');
INSERT INTO RE_RULES(RULE_CODE, LP_CODE, ACTIVITY_NAME, POINTS, VERSION) VALUES ('RER05','RLP01','Refer a friend',10,1);
INSERT INTO RR_RULES(RULE_CODE, LP_CODE, REWARD_NAME, POINTS, INSTANCES, VERSION) VALUES ('RRR05','RLP01','Gift Card',100,25,1);

-- Updating the IS_VALIDATED to 1 manually here, since it has to be done via application
-- UPDATE LOYALTY_PROGRAM SET LOYALTY_PROGRAM.IS_VALIDATED = 1;

-- Customer 1
INSERT INTO CUSTOMER values ('C0001','20 Ingram Street, NY','Peter Parker',8636234678,'W0001');
INSERT INTO ENROLL_CUSTOMER values ('C0001','TLP01');
INSERT INTO ENROLL_CUSTOMER values ('C0001','TLP02');

-- Perform Loyalty Activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','EARN','Write a review');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','EARN','Refer a friend');

-- Perform Redeem activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP01','REDEEM','Gift Card');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','REDEEM','Gift Card');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0001','TLP02','REDEEM','Free Product');

-- Customer 2
INSERT INTO CUSTOMER values ('C0002','569 Leaman Place, NY','Steve Rogers',8972468552,'W0002');
INSERT INTO ENROLL_CUSTOMER values ('C0002','TLP01');

-- Perform Loyalty Activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','EARN','Write a review');

-- Perform Redeem activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0002','TLP01','REDEEM','Free Product');

-- Customer 3
INSERT INTO CUSTOMER values ('C0003','1700 Broadway St, NY','Diana Prince',8547963210,'W0003');
INSERT INTO ENROLL_CUSTOMER values ('C0003','TLP02');
INSERT INTO ENROLL_CUSTOMER values ('C0003','RLP01');

-- Perform Loyalty Activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','EARN','Refer a friend');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','RLP01','EARN','Refer a friend');

-- Perform Redeem activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','REDEEM','Free Product');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0003','TLP02','REDEEM','Free Product');


-- Customer 4
INSERT INTO CUSTOMER values ('C0004','5015 Broad St, Philadelphia, PA','Billy Batson',8974562583,'W0004');

-- Customer 5
INSERT INTO CUSTOMER values ('C0005','10880 Malibu Point, CA','Tony Stark',8731596464,'W0005');
INSERT INTO ENROLL_CUSTOMER values ('C0005','TLP01');
INSERT INTO ENROLL_CUSTOMER values ('C0005','TLP02');
INSERT INTO ENROLL_CUSTOMER values ('C0005','RLP01');

-- Perform Loyalty Activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Purchase');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','EARN','Write a review');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP02','EARN','Purchase');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP02','EARN','Purchase');

INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','RLP01','EARN','Refer a friend');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','RLP01','EARN','Refer a friend');

-- Perform Redeem activity
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','REDEEM','Gift Card');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP01','REDEEM','Free Product');
INSERT INTO WALLET(WALLET_ID, LP_CODE, CATEGORY, ACTIVITY_NAME) values ('W0005','TLP02','REDEEM','Gift Card');


-- Queries
-- Q1
SELECT DISTINCT C.CUSTOMER_ID, C.NAME FROM CUSTOMER C, ENROLL_CUSTOMER EC, LOYALTY_PROGRAM LP WHERE LP.BRAND_ID = 'B02' and LP.CODE = EC.LP_CODE and EC.CUSTOMER_ID <> C.CUSTOMER_ID;
-- Q2 List customers that have joined a loyalty program but have not participated in any activity in that program
SELECT DISTINCT EC.CUSTOMER_ID, EC.LP_CODE FROM ENROLL_CUSTOMER EC WHERE EXISTS(SELECT W.WALLET_ID FROM WALLET W, CUSTOMER C WHERE EC.CUSTOMER_ID = C.CUSTOMER_ID and C.WALLET_ID = W.WALLET_ID and W.LP_CODE = EC.LP_CODE GROUP BY W.WALLET_ID, W.LP_CODE HAVING COUNT(*) < 2);
-- Q3
SELECT DISTINCT R.REWARD_ID, R.REWARD_NAME FROM REWARD R, LOYALTY_PROGRAM L WHERE L.BRAND_ID = 'B01' and R.LP_CODE = L.CODE;
-- Q4
SELECT CODE, NAME FROM LOYALTY_PROGRAM WHERE CODE IN (SELECT LP_CODE FROM RE_RULES WHERE ACTIVITY_NAME = 'Refer a friend');
-- Q5 For Brand01, list for each activity type in their loyalty program, the number instances that have occurred
SELECT W.ACTIVITY_NAME, COUNT(*) AS FREQUENCY FROM WALLET W WHERE W.CATEGORY = 'EARN' and W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B01') GROUP BY W.ACTIVITY_NAME;
-- Q6
SELECT DISTINCT C.CUSTOMER_ID, C.NAME FROM CUSTOMER C WHERE C.WALLET_ID IN (SELECT W.WALLET_ID FROM WALLET W WHERE W.CATEGORY = 'REDEEM' and W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B01') GROUP BY (W.WALLET_ID) HAVING COUNT(*) > 1);
-- Q7
SELECT DISTINCT B.BRAND_ID, B.BRAND_NAME FROM BRANDS B, LOYALTY_PROGRAM L WHERE B.BRAND_ID = L.BRAND_ID and L.CODE IN (SELECT LP_CODE FROM WALLET WHERE CATEGORY = 'REDEEM' GROUP BY LP_CODE HAVING -1*SUM(POINTS) < 500);
-- Q8 For Customer C0003, and Brand02, number of activities they have done in the period of 08/1/2021 and 9/30/2021
SELECT COUNT(*) as NUMBER_OF_ACTIVITIES FROM WALLET W WHERE W.LP_CODE = (SELECT CODE FROM LOYALTY_PROGRAM WHERE BRAND_ID = 'B02') and W.WALLET_ID = (SELECT WALLET_ID FROM CUSTOMER WHERE CUSTOMER_ID = 'C0003') and W."DATE" >= TO_DATE('11/06/2021', 'MM/DD/YYYY') and W."DATE" < TO_DATE('11/08/2021', 'MM/DD/YYYY');
